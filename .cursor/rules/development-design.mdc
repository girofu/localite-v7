---
description: ç•¶æœ‰æ–°çš„åŠŸèƒ½æˆ–æ¶æ§‹è¦å»ºç«‹æ™‚ï¼Œåƒè€ƒæ­¤ä»½æ–‡ä»¶ä¸­çš„åŸå‰‡é€²è¡Œé–‹ç™¼
alwaysApply: false
---

# åœ¨åœ°äºº AI å°è¦½ç³»çµ± - å®Œæ•´é–‹ç™¼æ¶æ§‹èˆ‡å¯¦æ–½æŒ‡å— v3

## ğŸ“‹ æ ¸å¿ƒè¨­è¨ˆåŸå‰‡

### 1. Local-First Architecture (æœ¬åœ°å„ªå…ˆæ¶æ§‹)

- **é›¢ç·šå¯ç”¨æ€§**ï¼šæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å¿…é ˆæ”¯æ´é›¢ç·šæ¨¡å¼
- **è³‡æ–™åŒæ­¥**ï¼šé€£ç·šå¾Œè‡ªå‹•åŒæ­¥ï¼Œè¡çªè‡ªå‹•è§£æ±º
- **æ¼¸é€²å¢å¼·**ï¼šåŸºç¤åŠŸèƒ½é›¢ç·šå¯ç”¨ï¼Œé€²éšåŠŸèƒ½éœ€è¦é€£ç·š

### 2. Test-Driven Development (TDD)

- **ç´…-ç¶ -é‡æ§‹å¾ªç’°**ï¼šå…ˆå¯«å¤±æ•—æ¸¬è©¦ï¼Œå†å¯¦ä½œï¼Œæœ€å¾Œå„ªåŒ–
- **æ¸¬è©¦è¦†è“‹ç‡ç›®æ¨™**ï¼šå–®å…ƒæ¸¬è©¦ >80%ï¼Œæ•´åˆæ¸¬è©¦ >70%
- **è‡ªå‹•åŒ–æ¸¬è©¦**ï¼šæ¯æ¬¡æäº¤è§¸ç™¼æ¸¬è©¦å¥—ä»¶

### 3. TypeScript First

- **åš´æ ¼æ¨¡å¼**ï¼šå•Ÿç”¨æ‰€æœ‰ TypeScript åš´æ ¼æª¢æŸ¥
- **é¡å‹è¦†è“‹**ï¼š95% ä»¥ä¸Šç¨‹å¼ç¢¼å¿…é ˆæœ‰æ˜ç¢ºé¡å‹
- **å…±äº«é¡å‹**ï¼šå‰å¾Œç«¯å…±ç”¨é¡å‹å®šç¾©

### 4. MVC Architecture Pattern

```typescript
// Model - è³‡æ–™å±¤
export class TourModel {
  private data: ITourData;
  private repository: ITourRepository;

  async findById(id: string): Promise<Tour> {
    // è³‡æ–™å­˜å–é‚è¼¯
  }
}

// View - è¦–åœ–å±¤
export const TourView: React.FC<ITourViewProps> = ({ tour }) => {
  return <View>{/* UI æ¸²æŸ“é‚è¼¯ */}</View>;
};

// Controller - æ§åˆ¶å±¤
export class TourController {
  constructor(private model: TourModel, private view: TourView) {}

  async handleUserAction(action: UserAction): Promise<void> {
    // æ¥­å‹™é‚è¼¯è™•ç†
  }
}
```

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

### 1. ç’°å¢ƒç®¡ç†ç­–ç•¥

```yaml
# ç’°å¢ƒé…ç½®å±¤ç´š
environments:
  development:
    config: .env.development
    database: mongodb://localhost/localite_dev
    features: all_enabled
    logging: verbose

  staging:
    config: .env.staging
    database: mongodb://staging/localite_staging
    features: selected_features
    logging: info

  production:
    config: .env.production
    database: mongodb://prod/localite
    features: feature_flags_controlled
    logging: error
```

### 2. WebSocket å³æ™‚é€šè¨Šæ¶æ§‹

```typescript
// WebSocket æœå‹™æ¶æ§‹
interface IChatService {
  // é€£æ¥ç®¡ç†
  connect(userId: string): Promise<void>;
  disconnect(): void;

  // è¨Šæ¯è™•ç†
  sendMessage(message: IMessage): Promise<void>;
  onMessage(callback: MessageCallback): void;

  // æ­·å²è¨˜éŒ„
  loadHistory(tourId: string): Promise<IMessage[]>;

  // ç‹€æ…‹ç®¡ç†
  getConnectionState(): ConnectionState;
  reconnect(): Promise<void>;
}

// å¯¦ä½œç¯„ä¾‹
class WebSocketChatService implements IChatService {
  private socket: Socket;
  private messageQueue: IMessage[] = [];
  private isConnected: boolean = false;

  async connect(userId: string): Promise<void> {
    this.socket = io(WS_ENDPOINT, {
      auth: { userId },
      reconnection: true,
      reconnectionAttempts: 5,
      reconnectionDelay: 1000,
    });

    this.setupEventHandlers();
  }

  private setupEventHandlers(): void {
    this.socket.on("connect", this.handleConnect);
    this.socket.on("disconnect", this.handleDisconnect);
    this.socket.on("message", this.handleMessage);
    this.socket.on("history", this.handleHistory);
  }

  async sendMessage(message: IMessage): Promise<void> {
    if (this.isConnected) {
      this.socket.emit("message", message);
    } else {
      // é›¢ç·šæ™‚åŠ å…¥ä½‡åˆ—
      this.messageQueue.push(message);
    }
  }
}
```

### 3. æœ¬åœ°å„ªå…ˆè³‡æ–™ç®¡ç†

```typescript
// æœ¬åœ°è³‡æ–™åº«æ¶æ§‹
interface ILocalDatabase {
  // åŸºç¤æ“ä½œ
  save<T>(collection: string, data: T): Promise<void>;
  find<T>(collection: string, query: Query): Promise<T[]>;
  update<T>(collection: string, id: string, data: Partial<T>): Promise<void>;
  delete(collection: string, id: string): Promise<void>;

  // åŒæ­¥æ©Ÿåˆ¶
  sync(): Promise<SyncResult>;
  getUnsyncedChanges(): Promise<Change[]>;
  resolveConflict(conflict: Conflict): Promise<void>;
}

// é›¢ç·šå„ªå…ˆæœå‹™
class OfflineFirstService {
  constructor(
    private localDB: ILocalDatabase,
    private remoteAPI: IRemoteAPI,
    private syncStrategy: ISyncStrategy
  ) {}

  async getData(id: string): Promise<Data> {
    // 1. å…ˆå¾æœ¬åœ°ç²å–
    const localData = await this.localDB.find("tours", { id });

    // 2. å¦‚æœåœ¨ç·šï¼Œå˜—è©¦æ›´æ–°
    if (this.isOnline()) {
      try {
        const remoteData = await this.remoteAPI.fetch(id);
        await this.localDB.update("tours", id, remoteData);
        return remoteData;
      } catch (error) {
        // å¤±æ•—æ™‚è¿”å›æœ¬åœ°è³‡æ–™
        return localData;
      }
    }

    return localData;
  }

  private isOnline(): boolean {
    return navigator.onLine;
  }
}
```

### 4. åŠŸèƒ½æ——æ¨™èˆ‡é‡‘çµ²é›€éƒ¨ç½²

```typescript
// åŠŸèƒ½æ——æ¨™æœå‹™
interface IFeatureFlagService {
  isEnabled(feature: string, userId?: string): boolean;
  getVariant(feature: string, userId: string): string;
  updateFlags(): Promise<void>;
}

class FeatureFlagService implements IFeatureFlagService {
  private flags: Map<string, FeatureFlag> = new Map();

  isEnabled(feature: string, userId?: string): boolean {
    const flag = this.flags.get(feature);
    if (!flag) return false;

    // é‡‘çµ²é›€éƒ¨ç½²é‚è¼¯
    if (flag.rolloutPercentage < 100) {
      return this.isUserInRollout(userId, flag.rolloutPercentage);
    }

    return flag.enabled;
  }

  private isUserInRollout(userId: string, percentage: number): boolean {
    // ä½¿ç”¨ hash ç¢ºä¿åŒä¸€ç”¨æˆ¶ç¸½æ˜¯å¾—åˆ°ç›¸åŒçµæœ
    const hash = this.hashUserId(userId);
    return hash % 100 < percentage;
  }
}

// ä½¿ç”¨ç¯„ä¾‹
const ChatComponent: React.FC = () => {
  const flags = useFeatureFlags();

  if (flags.isEnabled("new_chat_ui")) {
    return <NewChatUI />;
  }

  return <LegacyChatUI />;
};
```

### 5. Log ç›£æ§ç³»çµ±

```typescript
// çµ±ä¸€ Log ä»‹é¢
interface ILogger {
  debug(message: string, meta?: any): void;
  info(message: string, meta?: any): void;
  warn(message: string, meta?: any): void;
  error(message: string, error?: Error, meta?: any): void;

  // æ•ˆèƒ½è¿½è¹¤
  startTimer(label: string): void;
  endTimer(label: string): void;

  // ä½¿ç”¨è€…è¡Œç‚ºè¿½è¹¤
  trackEvent(event: string, properties?: any): void;
}

// Log èšåˆæœå‹™
class LogAggregator {
  private logs: LogEntry[] = [];
  private batchSize = 100;
  private flushInterval = 5000;

  constructor(private transport: ILogTransport) {
    this.startBatchProcessor();
  }

  log(entry: LogEntry): void {
    this.logs.push({
      ...entry,
      timestamp: Date.now(),
      sessionId: this.getSessionId(),
      deviceInfo: this.getDeviceInfo(),
    });

    if (this.logs.length >= this.batchSize) {
      this.flush();
    }
  }

  private async flush(): Promise<void> {
    if (this.logs.length === 0) return;

    const batch = this.logs.splice(0, this.batchSize);

    try {
      await this.transport.send(batch);
    } catch (error) {
      // å¤±æ•—æ™‚å­˜åˆ°æœ¬åœ°
      await this.saveToLocal(batch);
    }
  }
}
```

## ğŸš€ Mobile App å»ºç½®æµç¨‹

### 1. React Native + TypeScript è¨­ç½®

```json
// tsconfig.json
{
  "compilerOptions": {
    "target": "esnext",
    "module": "commonjs",
    "lib": ["es2017"],
    "jsx": "react-native",
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "resolveJsonModule": true
  }
}
```

### 2. Android å»ºç½®é…ç½®

```gradle
// android/app/build.gradle
android {
    compileSdkVersion 33

    defaultConfig {
        applicationId "com.localite.app"
        minSdkVersion 21
        targetSdkVersion 33
        versionCode 1
        versionName "1.0.0"
    }

    signingConfigs {
        release {
            storeFile file(RELEASE_STORE_FILE)
            storePassword RELEASE_STORE_PASSWORD
            keyAlias RELEASE_KEY_ALIAS
            keyPassword RELEASE_KEY_PASSWORD
        }
    }

    buildTypes {
        release {
            signingConfig signingConfigs.release
            minifyEnabled true
            proguardFiles getDefaultProguardFile('proguard-android.txt')
        }
    }
}
```

### 3. iOS å»ºç½®é…ç½®

```ruby
# ios/Podfile
platform :ios, '12.0'

target 'LocaliteApp' do
  config = use_native_modules!

  use_react_native!(
    :path => config[:reactNativePath],
    :hermes_enabled => true
  )

  # è‡ªå®šç¾© Pods
  pod 'Firebase/Analytics'
  pod 'Firebase/Crashlytics'

  post_install do |installer|
    react_native_post_install(installer)
  end
end
```

### 4. CI/CD Pipeline

```yaml
# .github/workflows/mobile-deploy.yml
name: Mobile App Deploy

on:
  push:
    branches: [main]
    tags: ["v*"]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: "18"
      - name: Install dependencies
        run: npm ci
      - name: Run tests
        run: npm test -- --coverage
      - name: TypeScript check
        run: npm run type-check

  build-android:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup JDK
        uses: actions/setup-java@v3
        with:
          java-version: "11"
      - name: Build APK
        run: |
          cd android
          ./gradlew assembleRelease
      - name: Upload to Play Store
        if: startsWith(github.ref, 'refs/tags/')
        run: |
          fastlane android deploy

  build-ios:
    needs: test
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Xcode
        uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: "14.0"
      - name: Build IPA
        run: |
          cd ios
          fastlane ios build
      - name: Upload to App Store
        if: startsWith(github.ref, 'refs/tags/')
        run: |
          fastlane ios deploy
```

## ğŸ“Š æˆåŠŸæŒ‡æ¨™èˆ‡ç›£æ§

### æŠ€è¡“æŒ‡æ¨™

- **TypeScript è¦†è“‹ç‡**ï¼š>95%
- **æ¸¬è©¦è¦†è“‹ç‡**ï¼š>80%
- **å»ºç½®æˆåŠŸç‡**ï¼š>95%
- **éƒ¨ç½²é »ç‡**ï¼šæ¯é€± 2-3 æ¬¡
- **å¹³å‡ä¿®å¾©æ™‚é–“**ï¼š<4 å°æ™‚

### æ•ˆèƒ½æŒ‡æ¨™

- **App å•Ÿå‹•æ™‚é–“**ï¼š<2 ç§’
- **API éŸ¿æ‡‰æ™‚é–“**ï¼š<200ms (P95)
- **WebSocket å»¶é²**ï¼š<100ms
- **é›¢ç·šè½‰åœ¨ç·šåŒæ­¥**ï¼š<5 ç§’
- **è¨˜æ†¶é«”ä½¿ç”¨**ï¼š<150MB

### ä½¿ç”¨è€…é«”é©—æŒ‡æ¨™

- **App Store è©•åˆ†**ï¼š>4.5
- **å´©æ½°ç‡**ï¼š<0.1%
- **é›¢ç·šå¯ç”¨æ€§**ï¼š>90%
- **åŠŸèƒ½æ¡ç”¨ç‡**ï¼š>40%
- **ä½¿ç”¨è€…ç•™å­˜ç‡**ï¼š>60% (30 å¤©)

## ğŸ—“ï¸ å¯¦æ–½æ™‚ç¨‹è¡¨

### Phase 1: åŸºç¤å»ºè¨­ (Week 1-2)

- ç’°å¢ƒè¨­ç½®èˆ‡ TypeScript é…ç½®
- TDD æ¡†æ¶å»ºç«‹
- MVC æ¶æ§‹å¯¦ä½œ
- æœ¬åœ°è³‡æ–™åº«è¨­è¨ˆ

### Phase 2: æ ¸å¿ƒåŠŸèƒ½ (Week 3-6)

- WebSocket èŠå¤©ç³»çµ±
- é›¢ç·šå„ªå…ˆè³‡æ–™ç®¡ç†
- AI å°è¦½æ•´åˆ
- ä½¿ç”¨è€…èªè­‰ç³»çµ±

### Phase 3: å¹³å°æ•´åˆ (Week 7-8)

- Android å»ºç½®æµç¨‹
- iOS å»ºç½®æµç¨‹
- CI/CD Pipeline
- è‡ªå‹•åŒ–æ¸¬è©¦

### Phase 4: éƒ¨ç½²èˆ‡ç›£æ§ (Week 9-10)

- åŠŸèƒ½æ——æ¨™ç³»çµ±
- é‡‘çµ²é›€éƒ¨ç½²
- Log ç›£æ§ç³»çµ±
- æ•ˆèƒ½å„ªåŒ–

### Phase 5: ä¸Šç·šèˆ‡è¿­ä»£ (Week 11-12)

- Beta æ¸¬è©¦
- æ¼¸é€²å¼ç™¼å¸ƒ
- ç›£æ§èˆ‡èª¿æ•´
- æ–‡æª”å®Œå–„

## ğŸ”’ å®‰å…¨æ€§è€ƒé‡

### 1. è³‡æ–™åŠ å¯†

- **æœ¬åœ°è³‡æ–™åº«åŠ å¯†**ï¼šä½¿ç”¨ SQLCipher æˆ–åŒç­‰åŠ å¯†æ–¹æ¡ˆ
- **å‚³è¼¸å±¤åŠ å¯†**ï¼šå¼·åˆ¶ä½¿ç”¨ TLS 1.3
- **æ•æ„Ÿè³‡æ–™é®ç½©**ï¼šæ—¥èªŒä¸­è‡ªå‹•éš±è—æ•æ„Ÿè³‡è¨Š

### 2. èªè­‰èˆ‡æˆæ¬Š

- **JWT Token ç®¡ç†**ï¼šçŸ­æœŸå­˜å– Token + é•·æœŸæ›´æ–° Token
- **Refresh Token æ©Ÿåˆ¶**ï¼šå®‰å…¨çš„ Token æ›´æ–°æµç¨‹
- **è§’è‰²æ¬Šé™æ§åˆ¶**ï¼šåŸºæ–¼è§’è‰²çš„å­˜å–æ§åˆ¶ (RBAC)

### 3. è¼¸å…¥é©—è­‰

- **SQL Injection é˜²è­·**ï¼šåƒæ•¸åŒ–æŸ¥è©¢
- **XSS é˜²è­·**ï¼šå…§å®¹æ¸…ç†èˆ‡ç·¨ç¢¼
- **CSRF é˜²è­·**ï¼šToken é©—è­‰æ©Ÿåˆ¶

### 4. éš±ç§ä¿è­·

- **GDPR åˆè¦**ï¼šä½¿ç”¨è€…è³‡æ–™æ§åˆ¶æ¬Š
- **è³‡æ–™æœ€å°åŒ–åŸå‰‡**ï¼šåªæ”¶é›†å¿…è¦è³‡æ–™
- **ä½¿ç”¨è€…è³‡æ–™åˆªé™¤æ¬Š**ï¼šå®Œæ•´çš„è³‡æ–™åˆªé™¤æµç¨‹

## ğŸ“š æ–‡æª”èˆ‡çŸ¥è­˜ç®¡ç†

### 1. æŠ€è¡“æ–‡æª”

- **API æ–‡æª”**ï¼šä½¿ç”¨ OpenAPI/Swagger è‡ªå‹•ç”Ÿæˆ
- **æ¶æ§‹æ±ºç­–è¨˜éŒ„**ï¼šADR æ ¼å¼è¨˜éŒ„é‡è¦æ±ºç­–
- **éƒ¨ç½²æ‰‹å†Š**ï¼šè©³ç´°çš„éƒ¨ç½²æ­¥é©Ÿèˆ‡å›æ»¾ç¨‹åº

### 2. é–‹ç™¼æŒ‡å—

- **ç¨‹å¼ç¢¼é¢¨æ ¼æŒ‡å—**ï¼šçµ±ä¸€çš„ç·¨ç¢¼æ¨™æº–
- **Git å·¥ä½œæµç¨‹**ï¼šåˆ†æ”¯ç­–ç•¥èˆ‡æäº¤è¦ç¯„
- **Code Review æ¨™æº–**ï¼šå¯©æŸ¥æ¸…å–®èˆ‡æœ€ä½³å¯¦è¸

### 3. ä½¿ç”¨è€…æ–‡æª”

- **ä½¿ç”¨æ‰‹å†Š**ï¼šåŠŸèƒ½èªªæ˜èˆ‡æ“ä½œæŒ‡å—
- **FAQ**ï¼šå¸¸è¦‹å•é¡Œèˆ‡è§£ç­”
- **æ•…éšœæ’é™¤æŒ‡å—**ï¼šå•é¡Œè¨ºæ–·èˆ‡è§£æ±ºæ–¹æ¡ˆ

## ğŸ¯ é—œéµæˆåŠŸå› ç´ 

### æŠ€è¡“å±¤é¢

1. **ç©©å®šçš„é›¢ç·šåŠŸèƒ½**ï¼šç¢ºä¿æ ¸å¿ƒåŠŸèƒ½é›¢ç·šå¯ç”¨
2. **æµæš¢çš„åŒæ­¥æ©Ÿåˆ¶**ï¼šç„¡æ„ŸçŸ¥çš„è³‡æ–™åŒæ­¥é«”é©—
3. **é«˜æ•ˆèƒ½æ¶æ§‹**ï¼šå¿«é€ŸéŸ¿æ‡‰èˆ‡ä½è³‡æºæ¶ˆè€—

### åœ˜éšŠå”ä½œ

1. **æ•æ·é–‹ç™¼æµç¨‹**ï¼šå¿«é€Ÿè¿­ä»£èˆ‡æŒçºŒæ”¹é€²
2. **çŸ¥è­˜å…±äº«æ–‡åŒ–**ï¼šå®šæœŸæŠ€è¡“åˆ†äº«èˆ‡æ–‡æª”åŒ–
3. **è‡ªå‹•åŒ–å„ªå…ˆ**ï¼šæ¸›å°‘æ‰‹å‹•æ“ä½œï¼Œæé«˜æ•ˆç‡

### ç”¢å“ç­–ç•¥

1. **ä½¿ç”¨è€…å°å‘è¨­è¨ˆ**ï¼šæ·±å…¥äº†è§£ä½¿ç”¨è€…éœ€æ±‚
2. **æ¼¸é€²å¼ç™¼å¸ƒ**ï¼šæ§åˆ¶é¢¨éšªï¼Œæ”¶é›†å›é¥‹
3. **æ•¸æ“šé©…å‹•æ±ºç­–**ï¼šåŸºæ–¼æŒ‡æ¨™å„ªåŒ–ç”¢å“

---

> ğŸ’¡ **æ³¨æ„äº‹é …**ï¼šæœ¬æ–‡æª”ç‚ºæ´»æ–‡æª”ï¼Œå°‡éš¨å°ˆæ¡ˆç™¼å±•æŒçºŒæ›´æ–°ã€‚æ‰€æœ‰åœ˜éšŠæˆå“¡éƒ½æ‡‰ç†Ÿæ‚‰ä¸¦éµå¾ªé€™äº›æŒ‡å°åŸå‰‡ã€‚

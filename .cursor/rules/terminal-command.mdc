---
alwaysApply: true
---
## ğŸ“‹ çµ‚ç«¯æ©ŸæŒ‡ä»¤è¦ç¯„ (æ–°å¢)

### æ¨™æº–åŒ–æŒ‡ä»¤é›†

æ‰€æœ‰çµ‚ç«¯æ©Ÿæ“ä½œå¿…é ˆéµå¾ªä»¥ä¸‹æ¨™æº–æŒ‡ä»¤é›†ï¼š

#### å°ˆæ¡ˆåˆå§‹åŒ–

```bash
# å°ˆæ¡ˆè¨­ç½®
cd /Users/fuchangwei/Projects/localite-v7
npm install                     # å®‰è£ä¾è³´
npm run setup                   # åˆå§‹åŒ–è¨­ç½®

# å¤šç³»çµ±ä¾è³´å®‰è£
./start-systems.sh              # å®‰è£æ‰€æœ‰å­ç³»çµ±ä¾è³´ä¸¦å•Ÿå‹•

# ç’°å¢ƒè¨­ç½®
cp .env.example .env           # å»ºç«‹ç’°å¢ƒæª”
cp .env .env.test              # å»ºç«‹æ¸¬è©¦ç’°å¢ƒ
cp .env .env.development       # å»ºç«‹é–‹ç™¼ç’°å¢ƒ
cp .env .env.staging           # å»ºç«‹æ¸¬è©¦ç’°å¢ƒ
cp .env .env.production        # å»ºç«‹ç”Ÿç”¢ç’°å¢ƒ
cp .env .env.ios              # iOS å°ˆç”¨ç’°å¢ƒè®Šæ•¸
```

#### TDD é–‹ç™¼å¾ªç’°æŒ‡ä»¤

```bash
# ç´…è‰²éšæ®µ - å¯«æ¸¬è©¦
npm run test:watch                            # ç›£è½æ¨¡å¼é‹è¡Œæ‰€æœ‰æ¸¬è©¦
npm run test:watch -- --testPathPattern=component  # ç›£è½ç‰¹å®šçµ„ä»¶æ¸¬è©¦
npm run test -- --testNamePattern="should create"  # é‹è¡Œç‰¹å®šæ¸¬è©¦

# ç¶ è‰²éšæ®µ - å¯¦ä½œåŠŸèƒ½
npm run dev                                    # å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨ (Expo)
npm run start                                  # å•Ÿå‹• Expo æ‡‰ç”¨
npm run android                               # Android æ¨¡æ“¬å™¨
npm run ios                                   # iOS æ¨¡æ“¬å™¨
npm run web                                   # Web ç‰ˆæœ¬
npm run test -- --coverage                    # é‹è¡Œæ¸¬è©¦ä¸¦ç”Ÿæˆè¦†è“‹ç‡
npm run type-check                            # TypeScript é¡å‹æª¢æŸ¥

# é‡æ§‹éšæ®µ - å„ªåŒ–ç¨‹å¼ç¢¼
npm run lint                                   # æª¢æŸ¥ç¨‹å¼ç¢¼è¦ç¯„
npm run lint:fix                              # è‡ªå‹•ä¿®å¾©æ ¼å¼å•é¡Œ
npm run type-check                            # TypeScript é¡å‹æª¢æŸ¥
```

#### æ¸¬è©¦åŸ·è¡ŒæŒ‡ä»¤

```bash
# æ¸¬è©¦é¡å‹
npm test                       # åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
npm run test:coverage         # ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
npm run test:watch            # ç›£è½æ¨¡å¼é‹è¡Œæ¸¬è©¦
npm run performance-test      # æ•ˆèƒ½æ¸¬è©¦
npm run verify-api-keys       # API Keys é©—è­‰

# ç‰¹å®šæ¸¬è©¦æª”æ¡ˆ
npm test -- --testPathPattern=services     # åªåŸ·è¡Œæœå‹™æ¸¬è©¦
npm test -- --testPathPattern=screens      # åªåŸ·è¡Œç•«é¢æ¸¬è©¦
npm test -- --testPathPattern=components   # åªåŸ·è¡Œçµ„ä»¶æ¸¬è©¦
npm test -- --testNamePattern="should create"    # åŸ·è¡Œç‰¹å®šæ¸¬è©¦

# ç’°å¢ƒæ¸¬è©¦
npm run pre-release-check     # ç™¼ä½ˆå‰æª¢æŸ¥
npm run verify-api-keys .env.production     # é©—è­‰ç”Ÿç”¢ç’°å¢ƒ API Keys
npm run verify-api-keys .env.staging        # é©—è­‰æ¸¬è©¦ç’°å¢ƒ API Keys
```

#### å»ºç½®èˆ‡éƒ¨ç½²æŒ‡ä»¤

```bash
# EAS å»ºç½® (æ¨è–¦)
eas build --platform all --profile preview         # é è¦½ç‰ˆå»ºç½® (iOS + Android)
eas build --platform ios --profile preview         # iOS é è¦½ç‰ˆå»ºç½®
eas build --platform android --profile preview     # Android é è¦½ç‰ˆå»ºç½®
eas build --platform all --profile production      # ç”Ÿç”¢ç‰ˆå»ºç½®
eas build --platform ios --profile production      # iOS ç”Ÿç”¢ç‰ˆå»ºç½®
eas build --platform android --profile production  # Android ç”Ÿç”¢ç‰ˆå»ºç½®

# æ‡‰ç”¨å•†åº—æäº¤
eas submit --platform ios --profile production     # æäº¤ iOS åˆ° App Store
eas submit --platform android --profile production # æäº¤ Android åˆ° Play Store
eas submit --platform ios --profile preview        # æäº¤ iOS æ¸¬è©¦ç‰ˆ
eas submit --platform android --profile preview    # æäº¤ Android å…§éƒ¨æ¸¬è©¦

# æ†‘è­‰ç®¡ç†
eas credentials                                   # ç®¡ç†å»ºç½®æ†‘è­‰
eas device:create                                 # è¨»å†Šæ¸¬è©¦è£ç½®
eas device:list                                   # åˆ—å‡ºå·²è¨»å†Šè£ç½®

# å‚³çµ±å»ºç½® (å¦‚æœéœ€è¦)
npm run build                  # Web ç‰ˆæœ¬å»ºç½®
npx expo prebuild -p ios       # iOS åŸç”Ÿå°ˆæ¡ˆé å»ºç½®
npx expo prebuild -p android   # Android åŸç”Ÿå°ˆæ¡ˆé å»ºç½®

# éƒ¨ç½²æº–å‚™æª¢æŸ¥
npm run pre-deploy-check       # éƒ¨ç½²å‰å®Œæ•´æª¢æŸ¥
npm run staging:setup          # è¨­å®šæ¸¬è©¦ç’°å¢ƒ
```

#### Git æ“ä½œæŒ‡ä»¤

```bash
# æäº¤æµç¨‹
git add .                                      # æš«å­˜æ‰€æœ‰è®Šæ›´
git status                                     # æª¢æŸ¥ç‹€æ…‹
git diff --staged                             # æª¢è¦–æš«å­˜è®Šæ›´
git commit -m "feat: add new feature" -m "Add user authentication flow"  # æäº¤è®Šæ›´

# åˆ†æ”¯ç®¡ç†
git checkout -b feature/auth-flow             # å»ºç«‹åŠŸèƒ½åˆ†æ”¯
git push origin feature/auth-flow            # æ¨é€åˆ†æ”¯
git checkout main                            # åˆ‡æ›ä¸»åˆ†æ”¯
git merge --no-ff feature/auth-flow          # åˆä½µåŠŸèƒ½åˆ†æ”¯

# æ¨™ç±¤ç®¡ç†
git tag -a v1.0.0 -m "Release version 1.0.0"  # å»ºç«‹ç‰ˆæœ¬æ¨™ç±¤
git push origin --tags                       # æ¨é€æ¨™ç±¤
```

#### å¤šç³»çµ±ç®¡ç†æŒ‡ä»¤

```bash
# å…¨ç³»çµ±å•Ÿå‹•
./start-systems.sh                           # å•Ÿå‹•æ‰€æœ‰ç³»çµ± (ç”¨æˆ¶ã€ç®¡ç†å“¡ã€å•†å®¶)
npm run start                                # å•Ÿå‹•ç”¨æˆ¶ç³»çµ± (Expo)
cd localite-admin-dashboard && npm start     # å•Ÿå‹•ç®¡ç†å“¡ç³»çµ±
cd localite-merchant-portal && npm start     # å•Ÿå‹•å•†å®¶ç³»çµ±

# å­ç³»çµ±ç®¡ç†
cd localite-app-stable && npm start          # ç”¨æˆ¶ App
cd localite-admin-dashboard && npm start     # ç®¡ç†å“¡å¾Œå° (port 3001)
cd localite-merchant-portal && npm start     # å•†å®¶é–€æˆ¶ (port 3002)

# ç³»çµ±ç‹€æ…‹æª¢æŸ¥
npx expo-doctor                              # Expo å°ˆæ¡ˆè¨ºæ–·
npm run pre-deploy-check                     # éƒ¨ç½²å‰æª¢æŸ¥
npm run verify-api-keys                      # API Keys é©—è­‰
```

#### iOS é–‹ç™¼ç’°å¢ƒæŒ‡ä»¤

```bash
# Xcode å•é¡Œä¿®å¾©
./scripts/fix-xcode.sh                       # ä¿®å¾© Xcode é…ç½®å•é¡Œ

# iOS ç’°å¢ƒè¨­ç½®
./scripts/ios-setup.sh                       # å®Œæ•´ iOS é–‹ç™¼ç’°å¢ƒè¨­ç½®
npx expo prebuild -p ios --clean             # æ¸…é™¤ä¸¦é‡æ–°å»ºç½® iOS å°ˆæ¡ˆ

# iOS æ¨¡æ“¬å™¨ç®¡ç†
xcrun simctl list devices                    # åˆ—å‡ºæ‰€æœ‰æ¨¡æ“¬å™¨
xcrun simctl boot "iPhone 15"                # å•Ÿå‹•ç‰¹å®šæ¨¡æ“¬å™¨
xcrun simctl shutdown all                    # é—œé–‰æ‰€æœ‰æ¨¡æ“¬å™¨

# æ†‘è­‰å’Œä½ˆå»ºæª”æ¡ˆ
eas credentials                              # EAS æ†‘è­‰ç®¡ç†
eas device:create                            # è¨»å†Šæ¸¬è©¦è£ç½®
```

#### ç’°å¢ƒè®Šæ•¸ç®¡ç†

```bash
# ç’°å¢ƒåˆ‡æ›
cp .env.production .env                      # åˆ‡æ›åˆ°ç”Ÿç”¢ç’°å¢ƒ
cp .env.staging .env                         # åˆ‡æ›åˆ°æ¸¬è©¦ç’°å¢ƒ
cp .env.development .env                     # åˆ‡æ›åˆ°é–‹ç™¼ç’°å¢ƒ
cp .env.ios .env                             # åˆ‡æ›åˆ° iOS ç’°å¢ƒ

# API Keys é©—è­‰
npm run verify-api-keys .env.production      # é©—è­‰ç”Ÿç”¢ç’°å¢ƒ
npm run verify-api-keys .env.staging         # é©—è­‰æ¸¬è©¦ç’°å¢ƒ
npm run verify-api-keys .env.development     # é©—è­‰é–‹ç™¼ç’°å¢ƒ
```

#### å°ˆæ¡ˆç¶­è­·æŒ‡ä»¤

```bash
# ç¨‹å¼ç¢¼å“è³ª
npm run lint                                 # ESLint æª¢æŸ¥
npm run lint:fix                             # è‡ªå‹•ä¿®å¾©æ ¼å¼å•é¡Œ
npm run type-check                           # TypeScript é¡å‹æª¢æŸ¥

# æ•ˆèƒ½æ¸¬è©¦
npm run performance-test                     # æ•ˆèƒ½åŸºæº–æ¸¬è©¦

# æ¸…ç†å’Œé‡ç½®
rm -rf node_modules && npm install           # é‡æ–°å®‰è£ä¾è³´
npx expo prebuild -p all --clean             # æ¸…é™¤åŸç”Ÿå°ˆæ¡ˆä¸¦é‡æ–°å»ºç½®
npx pod-install                              # iOS Pods é‡æ–°å®‰è£ (iOS)
```

#### æ—¥èªŒç®¡ç†ç³»çµ±æŒ‡ä»¤

```bash
# æ—¥èªŒç³»çµ±å•Ÿå‹•èˆ‡åœæ­¢
cd /Users/fuchangwei/Projects/localite-v7/localite-logs-dashboard
npm start                                    # å•Ÿå‹•å®Œæ•´æ—¥èªŒç®¡ç†ç³»çµ±
node server/server.js                        # å–®ç¨å•Ÿå‹•å¾Œç«¯æœå‹™å™¨
node server/server.js &                      # èƒŒæ™¯å•Ÿå‹•æœå‹™å™¨
pkill -f "server/server.js"                 # åœæ­¢æ—¥èªŒæœå‹™å™¨
pkill -9 -f "server/server.js"              # å¼·åˆ¶åœæ­¢æœå‹™å™¨

# æ—¥èªŒç³»çµ±ç‹€æ…‹æª¢æŸ¥
curl -s http://localhost:5001/api/health     # å¥åº·æª¢æŸ¥èˆ‡ç³»çµ±ç‹€æ…‹
lsof -i :5001                               # æª¢æŸ¥ç«¯å£ 5001 ä½”ç”¨æƒ…æ³
ps aux | grep "server/server.js" | grep -v grep  # æª¢æŸ¥æœå‹™å™¨é€²ç¨‹ç‹€æ…‹
curl -s http://localhost:5001 > /dev/null && echo "âœ… Dashboard æ­£å¸¸" || echo "âŒ Dashboard ç•°å¸¸"

# æ—¥èªŒæ¨é€ API æŒ‡ä»¤
curl -X POST http://localhost:5001/api/logs \
  -H "Content-Type: application/json" \
  -d '{"level": "info", "message": "æ¸¬è©¦è¨Šæ¯", "service": "test"}'  # æ¨é€ä¸€èˆ¬è³‡è¨Šæ—¥èªŒ

curl -X POST http://localhost:5001/api/logs \
  -H "Content-Type: application/json" \
  -d '{"level": "error", "message": "éŒ¯èª¤è¨Šæ¯", "service": "app", "metadata": {"error_code": "E001"}}'  # æ¨é€éŒ¯èª¤æ—¥èªŒ

curl -X POST http://localhost:5001/api/logs \
  -H "Content-Type: application/json" \
  -d '{"level": "warn", "message": "è­¦å‘Šè¨Šæ¯", "service": "auth", "metadata": {"screen": "RegisterScreen"}}'  # æ¨é€è­¦å‘Šæ—¥èªŒ

# æ—¥èªŒæŸ¥è©¢æŒ‡ä»¤
curl -s http://localhost:5001/api/logs                    # æŸ¥è©¢æ‰€æœ‰æ—¥èªŒ
curl -s "http://localhost:5001/api/logs?limit=50"         # æŸ¥è©¢æœ€è¿‘ 50 æ¢æ—¥èªŒ
curl -s "http://localhost:5001/api/logs?level=error"      # æŸ¥è©¢éŒ¯èª¤æ—¥èªŒ
curl -s "http://localhost:5001/api/logs?level=warn"       # æŸ¥è©¢è­¦å‘Šæ—¥èªŒ
curl -s "http://localhost:5001/api/logs?level=info"       # æŸ¥è©¢è³‡è¨Šæ—¥èªŒ
curl -s "http://localhost:5001/api/logs?service=localite-app"  # æŸ¥è©¢ä¸»æ‡‰ç”¨æ—¥èªŒ
curl -s "http://localhost:5001/api/logs?service=auth"     # æŸ¥è©¢èªè­‰ç›¸é—œæ—¥èªŒ

# è¤‡åˆæŸ¥è©¢æŒ‡ä»¤
curl -s "http://localhost:5001/api/logs?level=error&limit=20"     # æŸ¥è©¢æœ€è¿‘ 20 æ¢éŒ¯èª¤
curl -s "http://localhost:5001/api/logs?level=warn&service=auth"  # æŸ¥è©¢èªè­‰è­¦å‘Šæ—¥èªŒ
curl -s "http://localhost:5001/api/logs?service=register&limit=10" # æŸ¥è©¢è¨»å†Šç›¸é—œæ—¥èªŒ

# æ—¥èªŒåˆ†ææŒ‡ä»¤ (éœ€è¦ jq)
curl -s http://localhost:5001/api/logs | jq '.[0:5]'      # æ ¼å¼åŒ–é¡¯ç¤ºæœ€æ–° 5 æ¢
curl -s http://localhost:5001/api/logs | jq '.[] | select(.level=="error")'  # åªé¡¯ç¤ºéŒ¯èª¤æ—¥èªŒ
curl -s http://localhost:5001/api/logs | jq '.[] | {level, message, service, timestamp}'  # ç°¡åŒ–é¡¯ç¤º
curl -s http://localhost:5001/api/logs | jq 'group_by(.service) | map({service: .[0].service, count: length})'  # æŒ‰æœå‹™çµ±è¨ˆ

# æ—¥èªŒç›£æ§æŒ‡ä»¤
tail -f localite-logs-dashboard/server/logs/combined.log  # ç›£æ§æ‰€æœ‰æ—¥èªŒæ–‡ä»¶
tail -f localite-logs-dashboard/server/logs/error.log     # ç›£æ§éŒ¯èª¤æ—¥èªŒæ–‡ä»¶
watch -n 2 'curl -s http://localhost:5001/api/health | jq'  # å³æ™‚ç›£æ§ç³»çµ±å¥åº·ç‹€æ…‹

# æ—¥èªŒæ¸¬è©¦æŒ‡ä»¤é›†
curl -X POST http://localhost:5001/api/logs \
  -H "Content-Type: application/json" \
  -d '{"level": "info", "message": "ç³»çµ±å•Ÿå‹•æ¸¬è©¦", "service": "startup-test"}'

curl -X POST http://localhost:5001/api/logs \
  -H "Content-Type: application/json" \
  -d '{"level": "warn", "message": "è¨»å†ŠåŠŸèƒ½æ¸¬è©¦", "service": "auth-test", "metadata": {"screen": "RegisterScreen", "action": "button_click"}}'

curl -X POST http://localhost:5001/api/logs \
  -H "Content-Type: application/json" \
  -d '{"level": "error", "message": "æ¨¡æ“¬æ‡‰ç”¨éŒ¯èª¤", "service": "error-test", "metadata": {"error_code": "APP_ERROR", "component": "RegisterScreen"}}'

# æ—¥èªŒç³»çµ±æ¨™æº–åŒ–æ¸…ç† (æ¨è–¦)
./scripts/logs-system-cleanup.sh            # åŸ·è¡Œå®Œæ•´çš„ç³»çµ±æ¸…ç†å’Œé©—è­‰æµç¨‹
./scripts/logs-system-cleanup.sh --quick    # å¿«é€Ÿæ¸…ç†æ¨¡å¼

# æ—¥èªŒç³»çµ±æ•…éšœæ’é™¤ (æ‰‹å‹•æ–¹å¼)
lsof -i :5001 | grep LISTEN                 # æª¢æŸ¥ç«¯å£ç›£è½ç‹€æ…‹
pkill -9 -f ":5001"                         # å¼·åˆ¶é‡‹æ”¾ç«¯å£
netstat -an | grep 5001                      # æª¢æŸ¥ç«¯å£ç¶²è·¯ç‹€æ…‹
cd localite-logs-dashboard && rm -rf node_modules && npm install  # é‡æ–°å®‰è£ä¾è³´

# æ—¥èªŒæ–‡ä»¶ç®¡ç†
ls -la localite-logs-dashboard/server/logs/               # æŸ¥çœ‹æ—¥èªŒæ–‡ä»¶
du -h localite-logs-dashboard/server/logs/                # æŸ¥çœ‹æ—¥èªŒæ–‡ä»¶å¤§å°
cat localite-logs-dashboard/server/logs/error.log | tail -20      # æŸ¥çœ‹æœ€è¿‘éŒ¯èª¤
rm -rf localite-logs-dashboard/server/logs/*.log          # æ¸…ç©ºæ‰€æœ‰æ—¥èªŒæ–‡ä»¶

# æ‡‰ç”¨æ—¥èªŒæ•´åˆæª¢æŸ¥
cd localite-app-stable && grep -r "logger\." src/         # æŸ¥çœ‹å·²æ•´åˆçš„æ—¥èªŒé»
cd localite-app-stable && grep -r "LoggingService" src/   # æŸ¥çœ‹æ—¥èªŒæœå‹™ä½¿ç”¨æƒ…æ³
```

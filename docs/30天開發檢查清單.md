# 在地人 AI 導覽系統 - 30 天開發檢查清單

## 🚀 快速啟動 (Day 1)

### 環境確認

```bash
# 檢查 Node.js 版本
node --version  # 需要 >= 18.0.0
npm --version   # 需要 >= 9.0.0

# 檢查 Expo CLI
npx expo --version

# 檢查 Git 設置
git --version
```

### 專案初始化

```bash
cd /Users/fuchangwei/Projects/localite-v7

# 安裝依賴
npm install

# 確認專案可運行
npm start
```

## Week 1: 基礎建設 (Day 1-7)

### ✅ Day 1-2: Firebase 設置

#### 1. Firebase 專案建立

- [ ] 前往 [Firebase Console](https://console.firebase.google.com/)
- [ ] 建立新專案 "localite-ai-tour"
- [ ] 啟用以下服務：
  - [ ] Authentication (Email/Password + Google)
  - [ ] Firestore Database
  - [ ] Storage
  - [ ] Functions (可選)

#### 2. Firebase 設定檔下載

```bash
# 安裝 Firebase CLI
npm install -g firebase-tools

# 登入 Firebase
firebase login

# 初始化 Firebase 專案
firebase init
```

#### 3. React Native Firebase 整合

```bash
# 安裝 Firebase SDK
npm install firebase

# 安裝 Expo Firebase 套件
npx expo install @react-native-firebase/app
```

#### 4. Firebase 配置檔建立

```typescript
// src/config/firebase.ts
import { initializeApp } from "firebase/app";
import { getAuth } from "firebase/auth";
import { getFirestore } from "firebase/firestore";
import { getStorage } from "firebase/storage";

const firebaseConfig = {
  // 從 Firebase Console 複製設定
  apiKey: "your-api-key",
  authDomain: "your-auth-domain",
  projectId: "your-project-id",
  storageBucket: "your-storage-bucket",
  messagingSenderId: "your-sender-id",
  appId: "your-app-id",
};

const app = initializeApp(firebaseConfig);

export const auth = getAuth(app);
export const db = getFirestore(app);
export const storage = getStorage(app);
```

### ✅ Day 3-4: AI 服務整合

#### 1. Google AI Studio API 申請

- [ ] 前往 [Google AI Studio](https://makersuite.google.com/app/apikey)
- [ ] 申請 API Key
- [ ] 測試 API 連接

#### 2. AI 服務封裝

```typescript
// src/services/aiService.ts
export class AIService {
  private readonly apiKey: string;
  private readonly endpoint =
    "https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent";

  constructor(apiKey: string) {
    this.apiKey = apiKey;
  }

  async generateResponse(prompt: string): Promise<string> {
    try {
      const response = await fetch(`${this.endpoint}?key=${this.apiKey}`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          contents: [
            {
              parts: [
                {
                  text: prompt,
                },
              ],
            },
          ],
        }),
      });

      const data = await response.json();
      return (
        data.candidates[0]?.content?.parts[0]?.text ||
        "抱歉，我現在無法回答這個問題。"
      );
    } catch (error) {
      console.error("AI API 錯誤:", error);
      return "系統暫時無法回應，請稍後再試。";
    }
  }
}
```

#### 3. Google TTS 整合

```bash
# 安裝語音套件
npx expo install expo-speech
```

```typescript
// src/services/ttsService.ts
import * as Speech from "expo-speech";

export class TTSService {
  static async speak(text: string, language: string = "zh-TW"): Promise<void> {
    try {
      await Speech.speak(text, {
        language,
        pitch: 1.0,
        rate: 0.8,
      });
    } catch (error) {
      console.error("語音播放錯誤:", error);
    }
  }

  static stop(): void {
    Speech.stop();
  }
}
```

### ✅ Day 5-7: Mobile App 基礎

#### 1. 認證頁面建立

```typescript
// src/screens/LoginScreen.tsx
import React, { useState } from "react";
import { View, TextInput, Button, Alert } from "react-native";
import {
  signInWithEmailAndPassword,
  createUserWithEmailAndPassword,
} from "firebase/auth";
import { auth } from "../config/firebase";

export const LoginScreen: React.FC = () => {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");

  const handleLogin = async () => {
    try {
      await signInWithEmailAndPassword(auth, email, password);
      // 登入成功，導航到主頁面
    } catch (error) {
      Alert.alert("登入失敗", error.message);
    }
  };

  const handleRegister = async () => {
    try {
      await createUserWithEmailAndPassword(auth, email, password);
      // 註冊成功
    } catch (error) {
      Alert.alert("註冊失敗", error.message);
    }
  };

  return (
    <View>
      <TextInput
        placeholder="Email"
        value={email}
        onChangeText={setEmail}
        autoCapitalize="none"
      />
      <TextInput
        placeholder="密碼"
        value={password}
        onChangeText={setPassword}
        secureTextEntry
      />
      <Button title="登入" onPress={handleLogin} />
      <Button title="註冊" onPress={handleRegister} />
    </View>
  );
};
```

#### 2. 主要導覽介面

```typescript
// src/screens/TourScreen.tsx
import React, { useState } from "react";
import {
  View,
  TextInput,
  TouchableOpacity,
  ScrollView,
  Text,
} from "react-native";
import { AIService } from "../services/aiService";
import { TTSService } from "../services/ttsService";

export const TourScreen: React.FC = () => {
  const [question, setQuestion] = useState("");
  const [messages, setMessages] = useState<
    Array<{ type: "user" | "ai"; text: string }>
  >([]);
  const [loading, setLoading] = useState(false);

  const aiService = new AIService(process.env.GOOGLE_AI_API_KEY!);

  const handleSendQuestion = async () => {
    if (!question.trim()) return;

    const newMessages = [
      ...messages,
      { type: "user" as const, text: question },
    ];
    setMessages(newMessages);
    setLoading(true);

    try {
      const response = await aiService.generateResponse(question);
      setMessages([...newMessages, { type: "ai" as const, text: response }]);

      // 自動播放語音
      await TTSService.speak(response);
    } catch (error) {
      console.error("發送問題錯誤:", error);
    } finally {
      setLoading(false);
      setQuestion("");
    }
  };

  return (
    <View style={{ flex: 1, padding: 20 }}>
      <ScrollView style={{ flex: 1 }}>
        {messages.map((message, index) => (
          <View key={index} style={{ marginBottom: 10 }}>
            <Text
              style={{
                alignSelf: message.type === "user" ? "flex-end" : "flex-start",
                backgroundColor:
                  message.type === "user" ? "#007AFF" : "#E5E5EA",
                color: message.type === "user" ? "white" : "black",
                padding: 10,
                borderRadius: 10,
                maxWidth: "80%",
              }}
            >
              {message.text}
            </Text>
          </View>
        ))}
      </ScrollView>

      <View style={{ flexDirection: "row", alignItems: "center" }}>
        <TextInput
          style={{
            flex: 1,
            borderWidth: 1,
            borderColor: "#ddd",
            padding: 10,
            marginRight: 10,
            borderRadius: 5,
          }}
          placeholder="請問關於這個景點的問題..."
          value={question}
          onChangeText={setQuestion}
          multiline
        />
        <TouchableOpacity
          onPress={handleSendQuestion}
          disabled={loading}
          style={{
            backgroundColor: loading ? "#ccc" : "#007AFF",
            padding: 10,
            borderRadius: 5,
          }}
        >
          <Text style={{ color: "white" }}>
            {loading ? "思考中..." : "發送"}
          </Text>
        </TouchableOpacity>
      </View>
    </View>
  );
};
```

#### 3. 照片上傳功能

```bash
# 安裝相機和圖片選擇器
npx expo install expo-image-picker expo-camera
```

```typescript
// src/components/PhotoUpload.tsx
import React from "react";
import { View, TouchableOpacity, Text, Alert } from "react-native";
import * as ImagePicker from "expo-image-picker";
import { ref, uploadBytes, getDownloadURL } from "firebase/storage";
import { storage } from "../config/firebase";

export const PhotoUpload: React.FC<{
  onPhotoUploaded: (imageUrl: string) => void;
}> = ({ onPhotoUploaded }) => {
  const pickImage = async () => {
    const permissionResult =
      await ImagePicker.requestMediaLibraryPermissionsAsync();

    if (!permissionResult.granted) {
      Alert.alert("需要相簿權限", "請允許存取相簿以上傳照片");
      return;
    }

    const result = await ImagePicker.launchImageLibraryAsync({
      mediaTypes: ImagePicker.MediaTypeOptions.Images,
      allowsEditing: true,
      aspect: [4, 3],
      quality: 0.7,
    });

    if (!result.canceled) {
      uploadImage(result.assets[0].uri);
    }
  };

  const takePhoto = async () => {
    const permissionResult = await ImagePicker.requestCameraPermissionsAsync();

    if (!permissionResult.granted) {
      Alert.alert("需要相機權限", "請允許使用相機以拍攝照片");
      return;
    }

    const result = await ImagePicker.launchCameraAsync({
      allowsEditing: true,
      aspect: [4, 3],
      quality: 0.7,
    });

    if (!result.canceled) {
      uploadImage(result.assets[0].uri);
    }
  };

  const uploadImage = async (uri: string) => {
    try {
      const response = await fetch(uri);
      const blob = await response.blob();

      const imageRef = ref(storage, `tour-images/${Date.now()}.jpg`);
      await uploadBytes(imageRef, blob);

      const downloadURL = await getDownloadURL(imageRef);
      onPhotoUploaded(downloadURL);

      Alert.alert("上傳成功", "照片已上傳，可以開始詢問相關問題！");
    } catch (error) {
      console.error("上傳照片錯誤:", error);
      Alert.alert("上傳失敗", "照片上傳時發生錯誤，請稍後再試");
    }
  };

  return (
    <View
      style={{
        flexDirection: "row",
        justifyContent: "space-around",
        padding: 20,
      }}
    >
      <TouchableOpacity
        onPress={takePhoto}
        style={{
          backgroundColor: "#34C759",
          padding: 15,
          borderRadius: 10,
          minWidth: 100,
          alignItems: "center",
        }}
      >
        <Text style={{ color: "white", fontWeight: "bold" }}>拍照</Text>
      </TouchableOpacity>

      <TouchableOpacity
        onPress={pickImage}
        style={{
          backgroundColor: "#007AFF",
          padding: 15,
          borderRadius: 10,
          minWidth: 100,
          alignItems: "center",
        }}
      >
        <Text style={{ color: "white", fontWeight: "bold" }}>選擇照片</Text>
      </TouchableOpacity>
    </View>
  );
};
```

## Week 2: 核心功能開發 (Day 8-14)

### ✅ Day 8-10: AI 導覽功能完善

#### 1. 照片分析整合

```typescript
// src/services/visionService.ts
export class VisionService {
  private readonly apiKey: string;

  constructor(apiKey: string) {
    this.apiKey = apiKey;
  }

  async analyzeImage(imageUrl: string, question: string): Promise<string> {
    try {
      const response = await fetch(
        `https://generativelanguage.googleapis.com/v1/models/gemini-pro-vision:generateContent?key=${this.apiKey}`,
        {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            contents: [
              {
                parts: [
                  { text: `請分析這張照片並回答問題：${question}` },
                  {
                    inline_data: {
                      mime_type: "image/jpeg",
                      data: await this.imageToBase64(imageUrl),
                    },
                  },
                ],
              },
            ],
          }),
        }
      );

      const data = await response.json();
      return (
        data.candidates[0]?.content?.parts[0]?.text ||
        "無法分析此照片，請再試一次。"
      );
    } catch (error) {
      console.error("圖片分析錯誤:", error);
      return "圖片分析失敗，請確認網路連接或稍後再試。";
    }
  }

  private async imageToBase64(imageUrl: string): Promise<string> {
    const response = await fetch(imageUrl);
    const blob = await response.blob();
    return new Promise((resolve) => {
      const reader = new FileReader();
      reader.onload = () => {
        const base64 = (reader.result as string).split(",")[1];
        resolve(base64);
      };
      reader.readAsDataURL(blob);
    });
  }
}
```

#### 2. 語音控制優化

```typescript
// src/components/VoiceControl.tsx
import React, { useState } from "react";
import { TouchableOpacity, Text, View } from "react-native";
import { TTSService } from "../services/ttsService";
import * as Speech from "expo-speech";

export const VoiceControl: React.FC<{
  text: string;
  language?: string;
}> = ({ text, language = "zh-TW" }) => {
  const [isPlaying, setIsPlaying] = useState(false);

  const handlePlayPause = async () => {
    if (isPlaying) {
      Speech.stop();
      setIsPlaying(false);
    } else {
      setIsPlaying(true);
      await TTSService.speak(text, language);
      setIsPlaying(false);
    }
  };

  return (
    <TouchableOpacity
      onPress={handlePlayPause}
      style={{
        backgroundColor: isPlaying ? "#FF3B30" : "#34C759",
        padding: 8,
        borderRadius: 5,
        marginLeft: 10,
      }}
    >
      <Text style={{ color: "white", fontSize: 12 }}>
        {isPlaying ? "停止" : "播放"}
      </Text>
    </TouchableOpacity>
  );
};
```

### ✅ Day 11-14: 商戶後台開發

#### 1. 商戶註冊流程

```typescript
// src/screens/MerchantRegisterScreen.tsx
import React, { useState } from "react";
import { View, TextInput, Button, Alert, ScrollView } from "react-native";
import { collection, addDoc } from "firebase/firestore";
import { auth, db } from "../config/firebase";

export const MerchantRegisterScreen: React.FC = () => {
  const [businessInfo, setBusinessInfo] = useState({
    name: "",
    description: "",
    address: "",
    phone: "",
    category: "",
  });

  const handleSubmit = async () => {
    try {
      const merchantData = {
        ...businessInfo,
        userId: auth.currentUser?.uid,
        createdAt: new Date().toISOString(),
        status: "pending", // 待審核
      };

      await addDoc(collection(db, "merchants"), merchantData);
      Alert.alert(
        "註冊成功",
        "您的商戶資料已提交，我們將在 1-3 個工作天內審核。"
      );
    } catch (error) {
      console.error("商戶註冊錯誤:", error);
      Alert.alert("註冊失敗", "請檢查網路連接並稍後再試。");
    }
  };

  return (
    <ScrollView style={{ flex: 1, padding: 20 }}>
      <TextInput
        placeholder="商戶名稱"
        value={businessInfo.name}
        onChangeText={(text) =>
          setBusinessInfo({ ...businessInfo, name: text })
        }
        style={{
          borderWidth: 1,
          borderColor: "#ddd",
          padding: 10,
          marginBottom: 15,
          borderRadius: 5,
        }}
      />
      <TextInput
        placeholder="商戶描述"
        value={businessInfo.description}
        onChangeText={(text) =>
          setBusinessInfo({ ...businessInfo, description: text })
        }
        multiline
        numberOfLines={4}
        style={{
          borderWidth: 1,
          borderColor: "#ddd",
          padding: 10,
          marginBottom: 15,
          borderRadius: 5,
        }}
      />
      <TextInput
        placeholder="地址"
        value={businessInfo.address}
        onChangeText={(text) =>
          setBusinessInfo({ ...businessInfo, address: text })
        }
        style={{
          borderWidth: 1,
          borderColor: "#ddd",
          padding: 10,
          marginBottom: 15,
          borderRadius: 5,
        }}
      />
      <TextInput
        placeholder="聯絡電話"
        value={businessInfo.phone}
        onChangeText={(text) =>
          setBusinessInfo({ ...businessInfo, phone: text })
        }
        keyboardType="phone-pad"
        style={{
          borderWidth: 1,
          borderColor: "#ddd",
          padding: 10,
          marginBottom: 15,
          borderRadius: 5,
        }}
      />
      <TextInput
        placeholder="商戶類型 (例: 餐廳、景點、商店)"
        value={businessInfo.category}
        onChangeText={(text) =>
          setBusinessInfo({ ...businessInfo, category: text })
        }
        style={{
          borderWidth: 1,
          borderColor: "#ddd",
          padding: 10,
          marginBottom: 20,
          borderRadius: 5,
        }}
      />
      <Button title="提交註冊" onPress={handleSubmit} />
    </ScrollView>
  );
};
```

#### 2. 內容管理系統

```typescript
// src/screens/ContentManagementScreen.tsx
import React, { useState, useEffect } from "react";
import { View, Text, TextInput, Button, FlatList, Alert } from "react-native";
import {
  collection,
  addDoc,
  query,
  where,
  getDocs,
  updateDoc,
  doc,
} from "firebase/firestore";
import { auth, db } from "../config/firebase";
import { PhotoUpload } from "../components/PhotoUpload";

interface ContentItem {
  id: string;
  title: string;
  description: string;
  imageUrl?: string;
  category: string;
  createdAt: string;
}

export const ContentManagementScreen: React.FC = () => {
  const [contents, setContents] = useState<ContentItem[]>([]);
  const [newContent, setNewContent] = useState({
    title: "",
    description: "",
    category: "",
    imageUrl: "",
  });

  useEffect(() => {
    loadContents();
  }, []);

  const loadContents = async () => {
    try {
      const q = query(
        collection(db, "tourContents"),
        where("merchantId", "==", auth.currentUser?.uid)
      );
      const querySnapshot = await getDocs(q);
      const contentList: ContentItem[] = [];

      querySnapshot.forEach((doc) => {
        contentList.push({
          id: doc.id,
          ...doc.data(),
        } as ContentItem);
      });

      setContents(contentList);
    } catch (error) {
      console.error("載入內容錯誤:", error);
    }
  };

  const handleAddContent = async () => {
    if (!newContent.title || !newContent.description) {
      Alert.alert("請填寫完整資料", "標題和描述為必填項目");
      return;
    }

    try {
      const contentData = {
        ...newContent,
        merchantId: auth.currentUser?.uid,
        createdAt: new Date().toISOString(),
        status: "active",
      };

      await addDoc(collection(db, "tourContents"), contentData);

      setNewContent({
        title: "",
        description: "",
        category: "",
        imageUrl: "",
      });

      loadContents();
      Alert.alert("新增成功", "內容已成功新增");
    } catch (error) {
      console.error("新增內容錯誤:", error);
      Alert.alert("新增失敗", "請稍後再試");
    }
  };

  const renderContentItem = ({ item }: { item: ContentItem }) => (
    <View
      style={{
        backgroundColor: "#f9f9f9",
        padding: 15,
        marginVertical: 5,
        borderRadius: 8,
      }}
    >
      <Text style={{ fontSize: 16, fontWeight: "bold", marginBottom: 5 }}>
        {item.title}
      </Text>
      <Text style={{ color: "#666", marginBottom: 5 }}>{item.description}</Text>
      <Text style={{ color: "#999", fontSize: 12 }}>
        分類: {item.category} | 建立時間:{" "}
        {new Date(item.createdAt).toLocaleDateString()}
      </Text>
    </View>
  );

  return (
    <View style={{ flex: 1, padding: 20 }}>
      <Text style={{ fontSize: 20, fontWeight: "bold", marginBottom: 20 }}>
        內容管理
      </Text>

      <View style={{ marginBottom: 20 }}>
        <TextInput
          placeholder="內容標題"
          value={newContent.title}
          onChangeText={(text) => setNewContent({ ...newContent, title: text })}
          style={{
            borderWidth: 1,
            borderColor: "#ddd",
            padding: 10,
            marginBottom: 10,
            borderRadius: 5,
          }}
        />

        <TextInput
          placeholder="內容描述"
          value={newContent.description}
          onChangeText={(text) =>
            setNewContent({ ...newContent, description: text })
          }
          multiline
          numberOfLines={3}
          style={{
            borderWidth: 1,
            borderColor: "#ddd",
            padding: 10,
            marginBottom: 10,
            borderRadius: 5,
          }}
        />

        <TextInput
          placeholder="分類"
          value={newContent.category}
          onChangeText={(text) =>
            setNewContent({ ...newContent, category: text })
          }
          style={{
            borderWidth: 1,
            borderColor: "#ddd",
            padding: 10,
            marginBottom: 10,
            borderRadius: 5,
          }}
        />

        <PhotoUpload
          onPhotoUploaded={(imageUrl) =>
            setNewContent({ ...newContent, imageUrl })
          }
        />

        <Button title="新增內容" onPress={handleAddContent} />
      </View>

      <FlatList
        data={contents}
        keyExtractor={(item) => item.id}
        renderItem={renderContentItem}
        style={{ flex: 1 }}
        ListEmptyComponent={
          <Text style={{ textAlign: "center", color: "#999", marginTop: 50 }}>
            尚無內容，請新增第一筆資料
          </Text>
        }
      />
    </View>
  );
};
```

## Week 3: 整合與測試 (Day 15-21)

### ✅ Day 15-17: 多語言支援

#### 1. 語言切換系統

```typescript
// src/contexts/LanguageContext.tsx
import React, { createContext, useContext, useState } from "react";

type Language = "zh" | "en";

interface LanguageContextType {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string) => string;
}

const translations = {
  zh: {
    welcome: "歡迎使用在地人AI導覽",
    login: "登入",
    register: "註冊",
    email: "電子信箱",
    password: "密碼",
    askQuestion: "請問關於這個景點的問題...",
    send: "發送",
    thinking: "思考中...",
    takePhoto: "拍照",
    selectPhoto: "選擇照片",
    // 更多翻譯...
  },
  en: {
    welcome: "Welcome to Local AI Tour Guide",
    login: "Login",
    register: "Register",
    email: "Email",
    password: "Password",
    askQuestion: "Ask about this attraction...",
    send: "Send",
    thinking: "Thinking...",
    takePhoto: "Take Photo",
    selectPhoto: "Select Photo",
    // 更多翻譯...
  },
};

const LanguageContext = createContext<LanguageContextType | undefined>(
  undefined
);

export const LanguageProvider: React.FC<{ children: React.ReactNode }> = ({
  children,
}) => {
  const [language, setLanguage] = useState<Language>("zh");

  const t = (key: string): string => {
    return translations[language][key] || key;
  };

  return (
    <LanguageContext.Provider value={{ language, setLanguage, t }}>
      {children}
    </LanguageContext.Provider>
  );
};

export const useLanguage = () => {
  const context = useContext(LanguageContext);
  if (!context) {
    throw new Error("useLanguage must be used within a LanguageProvider");
  }
  return context;
};
```

#### 2. 語言切換按鈕

```typescript
// src/components/LanguageSwitch.tsx
import React from "react";
import { TouchableOpacity, Text, View } from "react-native";
import { useLanguage } from "../contexts/LanguageContext";

export const LanguageSwitch: React.FC = () => {
  const { language, setLanguage } = useLanguage();

  return (
    <View style={{ flexDirection: "row", alignItems: "center" }}>
      <TouchableOpacity
        onPress={() => setLanguage("zh")}
        style={{
          padding: 8,
          backgroundColor: language === "zh" ? "#007AFF" : "#f0f0f0",
          borderRadius: 5,
          marginRight: 5,
        }}
      >
        <Text style={{ color: language === "zh" ? "white" : "black" }}>
          中文
        </Text>
      </TouchableOpacity>

      <TouchableOpacity
        onPress={() => setLanguage("en")}
        style={{
          padding: 8,
          backgroundColor: language === "en" ? "#007AFF" : "#f0f0f0",
          borderRadius: 5,
        }}
      >
        <Text style={{ color: language === "en" ? "white" : "black" }}>
          English
        </Text>
      </TouchableOpacity>
    </View>
  );
};
```

### ✅ Day 18-21: 測試與錯誤處理

#### 1. 錯誤邊界組件

```typescript
// src/components/ErrorBoundary.tsx
import React from "react";
import { View, Text, TouchableOpacity } from "react-native";

interface State {
  hasError: boolean;
  error?: Error;
}

interface Props {
  children: React.ReactNode;
}

export class ErrorBoundary extends React.Component<Props, State> {
  constructor(props: Props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error("錯誤邊界捕獲錯誤:", error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return (
        <View
          style={{
            flex: 1,
            justifyContent: "center",
            alignItems: "center",
            padding: 20,
          }}
        >
          <Text style={{ fontSize: 18, marginBottom: 10 }}>
            哎呀，出了點問題！
          </Text>
          <Text
            style={{ color: "#666", marginBottom: 20, textAlign: "center" }}
          >
            應用程式遇到了未預期的錯誤，請重新啟動應用程式。
          </Text>
          <TouchableOpacity
            onPress={() => this.setState({ hasError: false })}
            style={{
              backgroundColor: "#007AFF",
              padding: 15,
              borderRadius: 8,
            }}
          >
            <Text style={{ color: "white" }}>重試</Text>
          </TouchableOpacity>
        </View>
      );
    }

    return this.props.children;
  }
}
```

#### 2. API 錯誤處理

```typescript
// src/utils/errorHandler.ts
export class APIError extends Error {
  constructor(
    message: string,
    public statusCode?: number,
    public originalError?: Error
  ) {
    super(message);
    this.name = "APIError";
  }
}

export const handleAPIError = (error: any): string => {
  if (error instanceof APIError) {
    return error.message;
  }

  if (error.code === "NETWORK_ERROR") {
    return "網路連接失敗，請檢查網路設定";
  }

  if (error.code === "TIMEOUT") {
    return "請求超時，請稍後再試";
  }

  return "發生未知錯誤，請稍後再試";
};
```

## Week 4: 部署與上線 (Day 22-30)

### ✅ Day 22-24: 部署準備

#### 1. 環境變數設定

```bash
# 建立 .env 檔案
echo "GOOGLE_AI_API_KEY=your_api_key_here" >> .env
echo "FIREBASE_WEB_API_KEY=your_firebase_api_key" >> .env
```

#### 2. 建置設定

```json
// app.json 更新
{
  "expo": {
    "name": "在地人AI導覽",
    "slug": "localite-ai-tour",
    "version": "1.0.0",
    "orientation": "portrait",
    "icon": "./assets/icon.png",
    "userInterfaceStyle": "light",
    "splash": {
      "image": "./assets/splash.png",
      "resizeMode": "contain",
      "backgroundColor": "#ffffff"
    },
    "assetBundlePatterns": ["**/*"],
    "ios": {
      "supportsTablet": true,
      "bundleIdentifier": "com.localite.aitour"
    },
    "android": {
      "adaptiveIcon": {
        "foregroundImage": "./assets/adaptive-icon.png",
        "backgroundColor": "#FFFFFF"
      },
      "package": "com.localite.aitour"
    },
    "web": {
      "favicon": "./assets/favicon.png"
    }
  }
}
```

### ✅ Day 25-28: 發布流程

#### 1. Expo 建置

```bash
# 安裝 EAS CLI
npm install -g @expo/eas-cli

# 登入 Expo
eas login

# 設定建置
eas build:configure

# 建置 Android APK
eas build --platform android --profile preview

# 建置 iOS
eas build --platform ios --profile preview
```

#### 2. 應用商店資料準備

- [ ] App 圖示設計 (1024x1024)
- [ ] 應用程式截圖 (多種尺寸)
- [ ] 應用程式描述文案
- [ ] 隱私權政策頁面
- [ ] 服務條款頁面

### ✅ Day 29-30: 監控與調整

#### 1. 基本分析追蹤

```typescript
// src/utils/analytics.ts
import { collection, addDoc } from "firebase/firestore";
import { db } from "../config/firebase";

export const trackEvent = async (eventName: string, properties?: any) => {
  try {
    await addDoc(collection(db, "analytics"), {
      event: eventName,
      properties: properties || {},
      timestamp: new Date().toISOString(),
      userId: auth.currentUser?.uid,
    });
  } catch (error) {
    console.error("追蹤事件錯誤:", error);
  }
};

// 使用範例
trackEvent("ai_question_asked", {
  questionLength: question.length,
  hasImage: !!imageUrl,
});
```

#### 2. 用戶反饋收集

```typescript
// src/screens/FeedbackScreen.tsx
import React, { useState } from "react";
import { View, TextInput, Button, Alert, Text } from "react-native";
import { collection, addDoc } from "firebase/firestore";
import { auth, db } from "../config/firebase";

export const FeedbackScreen: React.FC = () => {
  const [feedback, setFeedback] = useState("");
  const [rating, setRating] = useState(5);

  const submitFeedback = async () => {
    try {
      await addDoc(collection(db, "feedback"), {
        content: feedback,
        rating,
        userId: auth.currentUser?.uid,
        timestamp: new Date().toISOString(),
      });

      Alert.alert("謝謝您的反饋！", "您的意見對我們很重要，我們會持續改進。");
      setFeedback("");
      setRating(5);
    } catch (error) {
      console.error("提交反饋錯誤:", error);
      Alert.alert("提交失敗", "請稍後再試");
    }
  };

  return (
    <View style={{ flex: 1, padding: 20 }}>
      <Text style={{ fontSize: 20, marginBottom: 20 }}>您的反饋</Text>

      <TextInput
        placeholder="請告訴我們您的使用體驗和建議..."
        value={feedback}
        onChangeText={setFeedback}
        multiline
        numberOfLines={5}
        style={{
          borderWidth: 1,
          borderColor: "#ddd",
          padding: 15,
          marginBottom: 20,
          borderRadius: 8,
          textAlignVertical: "top",
        }}
      />

      <Button title="提交反饋" onPress={submitFeedback} />
    </View>
  );
};
```

## 🎯 關鍵檢查點

### 每日檢查 (必須完成)

- [ ] Git 提交推送
- [ ] 功能測試通過
- [ ] 錯誤日誌檢查
- [ ] 效能監控確認

### 週末檢查 (重要里程碑)

- [ ] 功能演示可正常運行
- [ ] 用戶反饋收集與處理
- [ ] 下週任務規劃調整
- [ ] 風險評估與應對

## 🚨 緊急應變計劃

### 如果遇到技術障礙

1. **API 服務問題** - 啟用離線模式或備用 API
2. **資料庫連接問題** - 使用本地快取或備用資料庫
3. **建置失敗** - 回退到上個穩定版本

### 如果時間不足

1. **優先功能** - AI 對話 > 照片上傳 > 商戶功能
2. **延後功能** - 語音播放 > 多語言 > 商戶後台
3. **最小可行產品** - 僅保留 AI 對話和基本認證

---

**這份檢查清單確保 30 天內能夠交付可用的 MVP，專注於驗證核心假設而非完美產品。**

